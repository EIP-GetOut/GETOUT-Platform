/*
** Copyright GETOUT SAS - All Rights Reserved
** Unauthorized copying of this file, via any medium is strictly prohibited
** Proprietary and confidential
** Wrote by Julien Letoux <julien.letoux@epitech.eu>
*/

import { expect, it } from '@jest/globals'
import { describe } from 'node:test'
import request from 'supertest'

import { app } from '@config/jestSetup'

describe('Books Routes', () => {
  it('should respond with 200 OK for GET /generate-books?intitle=fleurs', async () => {
    await request(app).get('/generate-books?intitle=fleurs').then((response) => {
      expect(response.status).toBe(200)
      // eslint-disable-next-line no-useless-escape
      expect(response.text).toBe('{\"books\":[{\"title\":\"Les Fleurs Du Mal\",\"poster\":null,\"id\":\"mX4BLwEACAAJ\",\"overview\":\"No informations.\"},{\"title\":\"The Flowers of Evil: (Les Fleurs du mal)\",\"poster\":\"http://books.google.com/books/content?id=U0YfEAAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"U0YfEAAAQBAJ\",\"overview\":\"On the 200th anniversary of Baudelaire’s birth comes this stunning landmark translation of the book that launched modern poetry. Known to his contemporaries primarily as an art critic, but ambitious to secure a more lasting literary legacy, Charles Baudelaire, a Parisian bohemian, spent much of the 1840s composing gritty, often perverse, poems that expressed his disgust with the banality of modern city life. First published in 1857, the book that collected these poems together, Les Fleurs du mal, was an instant sensation—earning Baudelaire plaudits and, simultaneously, disrepute. Only a year after Gustave Flaubert had endured his own public trial for published indecency (for Madame Bovary), a French court declared Les Fleurs du mal an offense against public morals and six poems within it were immediately suppressed (a ruling that would not be reversed until 1949, nearly a century after Baudelaire’s untimely death). Subsequent editions expanded on the original, including new poems that have since been recognized as Baudelaire’s masterpieces, producing a body of work that stands as the most consequential, controversial, and influential book of poetry from the nineteenth century. Acclaimed translator and poet Aaron Poochigian tackles this revolutionary text with an ear attuned to Baudelaire’s lyrical innovations—rendering them in “an assertive blend of full and slant rhymes and fluent iambs” (A. E. Stallings)—and an intuitive feel for the work’s dark and brooding mood. Poochigian’s version captures the incantatory, almost magical, effect of the original—reanimating for today’s reader Baudelaire’s “unfailing vision” that “trumpeted the space and light of the future” (Patti Smith). An introduction by Dana Gioia offers a probing reassessment of the supreme artistry of Baudelaire’s masterpiece, and an afterword by Daniel Handler explores its continued relevance and appeal. Featuring the poems in English and French, this deluxe dual-language edition allows readers to commune both with the original poems and with these electric, revelatory translations.\"},{\"title\":\"Zwarte Venus\",\"poster\":\"http://books.google.com/books/content?id=mmRyDAAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"mmRyDAAAQBAJ\",\"overview\":\"Met Les Fleurs du Mal (1857) van Charles Baudelaire blies er een nieuwe wind door de Franse poëzie. Zijn bloemen van het kwaad wasemden schoonheid en verderf uit. Voor zijn Zwarte Venus, de mulattin Jeanne Duval, trok de dichter alle erotische registers open. Thema’s als prostitutie, sadisme en fetisjisme schokten de goegemeente zozeer dat een Parijse rechtbank hem prompt veroordeelde. Deze bloemlezing biedt de vijftig beste verzen uit de bundel. Meestervertaler Paul Claes brengt een eerbetoon aan de volmaakte versvorm, de suggestieve klankeffecten en de associatieve beeldspraak van het origineel. De uitwaaierende symboliek maakt elk gedicht volgens de criticus Lloyd James Austin ‘een raam dat uitzicht biedt op het oneindige’. Een inleiding, een biografie en een commentaar vervolledigen deze poëtische presentatie van de grootste Franse symbolist.\"},{\"title\":\"The Flowers of Evil / Les Fleurs du Mal : English - French Bilingual Edition\",\"poster\":\"http://books.google.com/books/content?id=XXRgDwAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"XXRgDwAAQBAJ\",\"overview\":\"Les Fleurs du mal (English: The Flowers of Evil) is a volume of French poetry by Charles Baudelaire. First published in 1857, it was important in the symbolist and modernist movements. The poems deal with themes relating to decadence and eroticism. This Bilingual English - French edition provides the original text by Baudelaire and its English translation by Cyril Scott. The initial publication of the book was arranged in six thematically segregated sections: 1. Spleen et Idéal (Spleen and Ideal) 2. Tableaux parisiens (Parisian Scenes) 3. Le Vin (Wine) 4. Fleurs du mal (Flowers of Evil) 5. Révolte (Revolt) 6. La Mort (Death) Baudelaire dedicated the book to the poet Théophile Gautier, describing him as a parfait magicien des lettres françaises (\\\"a perfect magician of French letters\\\"). The foreword to the volume, Au Lecteur (\\\"To the Reader\\\"), identifying Satan with the pseudonymous alchemist Hermes Trismegistus. The author and the publisher were prosecuted under the regime of the Second Empire as an outrage aux bonnes moeurs (\\\"an insult to public decency\\\"). As a consequence of this prosecution, Baudelaire was fined 300 francs. Six poems from the work were suppressed and the ban on their publication was not lifted in France until 1949. These poems were \\\"Lesbos\\\"; \\\"Femmes damnées (À la pâle clarté)\\\" (or \\\"Women Doomed (In the pale glimmer...)\\\"); \\\"Le Léthé\\\" (or \\\"Lethe\\\"); \\\"À celle qui est trop gaie\\\" (or \\\"To Her Who Is Too Joyful\\\"); \\\"Les Bijoux\\\" (or \\\"The Jewels\\\"); and \\\" Les \\\"Métamorphoses du Vampire\\\" (or \\\"The Vampire\'s Metamorphoses\\\"). These were later published in Brussels in a small volume entitled Les Épaves (Scraps or Jetsam). On the other hand, upon reading \\\"The Swan\\\" (or \\\"Le Cygne\\\") from Les Fleurs du mal, Victor Hugo announced that Baudelaire had created \\\"un nouveau frisson\\\" (a new shudder, a new thrill) in literature. In the wake of the prosecution, a second edition was issued in 1861 which added 35 new poems, removed the six suppressed poems, and added a new section entitled Tableaux Parisiens. A posthumous third edition, with a preface by Théophile Gautier and including 14 previously unpublished poems, was issued in 1868.\"},{\"title\":\"Les Fleurs Du Mal\",\"poster\":\"http://books.google.com/books/content?id=hdhNV-5TKgIC&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"hdhNV-5TKgIC\",\"overview\":\"Presents the first American translation of the complete text of Baudelaire\'s 1857 masterwork and includes the complete original French texts for easy comparison\"},{\"title\":\"Des fleurs pour Algernon\",\"poster\":\"http://books.google.com/books/content?id=QUo6AAAACAAJ&printsec=frontcover&img=1&zoom=1&source=gbs_api\",\"id\":\"QUo6AAAACAAJ\",\"overview\":\"Algernon est une souris de laboratoire dont le traitement du Pr Nemur et du Dr Strauss vient de décupler l\'intelligence. Enhardis par cette réussite, les deux savants tentent alors, avec l\'assistance de la psychologue Alice Kinnian, d\'appliquer leur découverte à Charlie Gordon, un simple d\'esprit employé dans une boulangerie. C\'est bientôt l\'extraordinaire éveil de l\'intelligence pour le jeune homme. Il découvre un monde dont il avait toujours été exclu, et l\'amour qui naît entre Alice et lui achève de le métamorphoser. Mais un jour, les facultés supérieures d\'Algernon déclinent. Commence alors pour Charlie le drame atroce d\'un homme qui, en pleine conscience, se sent retourner à l\'état de bête...\"},{\"title\":\"The Flowers of Evil / Les Fleurs Du Mal (Dual language French English Edition)\",\"poster\":\"http://books.google.com/books/content?id=aInTDwAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"aInTDwAAQBAJ\",\"overview\":\"Upon its original publication in 1857 Charles Baudelaire\'s \\\"Les Fleurs du Mal\\\" or \\\"The Flowers of Evil\\\" was embroiled in controversy. Within a month of its publication the French authorities brought an action against the author and the book\'s publisher claiming that the work was an insult to public decency. Eventually the French courts would acknowledge the literary merit of Baudelaire\'s work but ordered that six poems in particular should be banned from subsequent publication. The notoriety caused by this scandal would ultimately work in the author\'s favor causing the initial publication to sell out, thus prompting the publication of another edition. The second edition was published in 1861, it included an additional thirty-five poems, with the exclusion of the six poems censored by the French government. Finally in 1868 a third edition was published posthumously.\"},{\"title\":\"Poems of Baudelaire (Les Fleurs du Mal)\",\"poster\":\"http://books.google.com/books/content?id=NIl_EAAAQBAJ&printsec=frontcover&img=1&zoom=1&edge=curl&source=gbs_api\",\"id\":\"NIl_EAAAQBAJ\",\"overview\":\"DigiCat Publishing presents to you this special edition of \\\"Poems of Baudelaire (Les Fleurs du Mal)\\\" by Charles Baudelaire. DigiCat Publishing considers every written word to be a legacy of humankind. Every DigiCat book has been carefully reproduced for republishing in a new modern format. The books are available in print, as well as ebooks. DigiCat hopes you will treat this work with the acknowledgment and passion it deserves as a classic of world literature.\"},{\"title\":\"The Flowers of Evil / Les Fleurs Du Mal (Bilingual English - French Edition)\",\"poster\":\"http://books.google.com/books/content?id=yZPfuAEACAAJ&printsec=frontcover&img=1&zoom=1&source=gbs_api\",\"id\":\"yZPfuAEACAAJ\",\"overview\":\"Les Fleurs du mal (English: The Flowers of Evil) is a volume of French poetry by Charles Baudelaire. First published in 1857, it was important in the symbolist and modernist movements. The poems deal with themes relating to decadence and eroticism.This new Bilingual English - French edition provides the original text of Charles Baudelaire with a powerful translation by Cyril Scott.\"},{\"title\":\"Les Fleurs Du Mal\",\"poster\":null,\"id\":\"mz0JygEACAAJ\",\"overview\":\"No informations.\"}]}')
    })
  })

  it('should respond with 500 Bad Request', async () => {
    await request(app).get('/generate-books').then((response) => {
      expect(response.status).toBe(500)
      // eslint-disable-next-line no-useless-escape
      expect(response.text).toBe('{\"name\":\"ApiError\",\"message\":\"Bad Request\"}')
    })
  })
})
